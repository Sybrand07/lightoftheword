<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light of the Word - Inspiration</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/lightoftheword/static/style.css">
    <link rel="icon" href="/lightoftheword/static/favicon.ico" type="image/x-icon">
    <!-- Include Font Awesome CDN for icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>

    <!-- Full-width Navigation Bar -->
    <nav class="navbar">
        <div class="container">
            <a href="#" class="logo">Light of the Word</a>
            <ul class="nav-links">
                <li><a href="/#home">Home</a></li>
                <li><a href="/#about">About</a></li>
                <li><a href="/#products">Products</a></li>
                <li><a href="/inspiration">Inspiration</a></li>
                <li><a href="/#contacts">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero" id="home">
        <div class="hero-text">
            <h1>Inspiration</h1>
            <p>Explore Bible study topics and find inspiration in the Word of God.</p>
            <a href="#the-power-of-scripture" class="cta-button">Discover More</a>
        </div>
    </header>

    <!-- Inspiration Page Content -->
    <div class="inspiration-container">
        <!-- Left Side: Bible Study Topics Tabs -->
        <div class="inspiration-tabs">
            <h2>Bible Study Topics</h2>
            <ul>
                <li><a href="#" data-target="#genesis">The Book of Genesis</a></li>
                <li><a href="#" data-target="#the-power-of-scripture">The Power of Scripture</a></li>
                <li><a href="#" data-target="#curious-history">Curious History</a></li>
                <li><a href="#" data-target="#theological-questions">Theological Questions</a></li>
                <li><a href="#" data-target="#islam-in-context">Islam in Context</a></li>
            </ul>
        </div>

        <!-- Right Side: Bible Study Content -->
        <div class="inspiration-content">
            <!-- Toggle View Button at the Top of the Right Side -->
            <div class="view-toggle-container">
                <button id="toggleViewBtn">
                    <!-- Card View Icon -->
                    <i id="card-view-icon" class="material-icons">view_carousel</i>
            
                    <!-- List View Icon -->
                    <i id="list-view-icon" class="material-icons">view_list</i>
            
                    <!-- Thumbnail View Icon -->
                    <i id="thumbnail-view-icon" class="material-icons">view_module</i>
                </button>
            </div>
            <div class="content-container" id="dynamic-content">
                <!-- Content will be loaded here dynamically -->
            </div>
        </div>

        <!-- First Modal (Summary) -->
        <div id="summary-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <img id="summary-modal-image" src="" alt="Summary Image" class="modal-img">
                <div id="summary-modal-body"></div>
                <button id="read-more-btn">Read More</button> <!-- Read More Button -->
            </div>
        </div>

        <!-- Second Modal (Full Content) -->
        <div id="full-content-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <img id="full-modal-image" src="" alt="Full Image" class="modal-img">
                <div id="full-modal-body"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Light of the Word. All rights reserved.</p>
        <p><a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
    </footer>
  
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const dynamicContent = document.getElementById("dynamic-content");
            const tabLinks = document.querySelectorAll('.inspiration-tabs a');
            const contentSections = document.querySelectorAll('.content-section');
            let toggleViewBtn = document.getElementById('toggleViewBtn');
            const cardViewIcon = document.getElementById('card-view-icon');
            const listViewIcon = document.getElementById('list-view-icon');
            const thumbnailViewIcon = document.getElementById('thumbnail-view-icon');
            let viewMode = "card"; // Initial mode: "card", "list", or "thumbnail"

            // Fetch and load dynamically generated content
            fetch("/lightoftheword/templates/generated_content.html")
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Failed to load content");
                    }
                    return response.text();
                })
                .then(data => {
                    dynamicContent.innerHTML = data;
                    switchToCardView(); // Convert to Card View immediately
                    attachEventListeners();
                })
                .catch(error => {
                    console.error("Error loading content:", error);
                    dynamicContent.innerHTML = "<p>Sorry, there was an error loading the content.</p>";
                });

            contentSections.forEach((section) => {
                let originalData = [];
                section.querySelectorAll(".accordion").forEach((button) => {
                    originalData.push({
                        title: button.textContent,
                        fileName: button.getAttribute("data-file"),
                        date: button.getAttribute("data-date"),
                    });
                });

                // Store data as JSON so we can use it later
                section.dataset.originalData = JSON.stringify(originalData);
            });

            // Tab Switching Functionality
            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    tabLinks.forEach(tab => tab.classList.remove('active'));
                    contentSections.forEach(section => section.classList.remove('active'));
                    link.classList.add('active');
                    const targetContent = document.querySelector(link.getAttribute('data-target'));
                    targetContent.classList.add('active');
                    targetContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });

            // Cycle through three views when button is clicked
            toggleViewBtn.addEventListener('click', function() {
                if (viewMode === "card") {
                    switchToListView();
                } else if (viewMode === "list") {
                    switchToThumbnailView();
                } else if (viewMode === "thumbnail") {
                    switchToCardView();
                }
            });

            function switchToCardView() {
                // Clear any previously existing classes
                document.querySelector(".inspiration-content").classList.add("card-view");
                document.querySelector(".inspiration-content").classList.remove("list-view", "thumbnail-view");

                cardViewIcon.style.display = "none";
                listViewIcon.style.display = "inline-block";
                thumbnailViewIcon.style.display = "none";

                // Restore cards using stored data
                contentSections.forEach((section) => {
                    section.innerHTML = convertToCards(section);
                });

                const cardContainers = document.querySelectorAll('.card-container'); // Get the card containers

                addCardInteractions(cardContainers);

                // Re-initialize dynamic content and event listeners

                viewMode = "card";

            }

            function switchToListView() {
                document.querySelector('.inspiration-content').classList.add('list-view');
                document.querySelector('.inspiration-content').classList.remove('card-view', 'thumbnail-view');

                cardViewIcon.style.display = 'none';
                listViewIcon.style.display = 'none';
                thumbnailViewIcon.style.display = 'inline-block';

                contentSections.forEach(section => {
                    section.innerHTML = convertToAccordion(section);
                });

                // Re-initialize dynamic content and event listeners
                initializeAccordions();
                viewMode = "list";
            }

            function switchToThumbnailView() {
                document.querySelector('.inspiration-content').classList.add('thumbnail-view');
                document.querySelector('.inspiration-content').classList.remove('card-view', 'list-view');

                cardViewIcon.style.display = 'inline-block';
                listViewIcon.style.display = 'none';
                thumbnailViewIcon.style.display = 'none';

                contentSections.forEach(section => {
                    section.innerHTML = convertToThumbnails(section);
                });

                // Re-initialize dynamic content and event listeners
                initializeAccordions();
                viewMode = "thumbnail";
            }

            // Accordion Behavior (List View)
            function initializeAccordions() {
                const accordions = document.querySelectorAll('.accordion');
                accordions.forEach(button => {
                    button.addEventListener('click', function() {
                        this.classList.toggle('active');
                        const contentDiv = this.nextElementSibling;
                        const contentContainer = contentDiv.querySelector('.content-placeholder');
                        const fileName = this.getAttribute('data-file');

                        if (contentDiv.style.display === 'block') {
                            contentDiv.style.display = 'none';
                        } else {
                            contentDiv.style.display = 'block';

                            if (!contentContainer.dataset.loaded) {
                                fetch(`/lightoftheword/static/content/${fileName}`)
                                    .then(response => response.text())
                                    .then(data => {
                                        contentContainer.innerHTML = data;
                                        contentContainer.dataset.loaded = true;
                                    })
                                    .catch(error => {
                                        contentContainer.innerHTML = "<p style='color: red;'>Error loading content.</p>";
                                        console.error("Error fetching content:", error);
                                    });
                            }
                        }
                    });
                });
            }
            // Initialize the accordions on page load
            initializeAccordions();

            // Function to Convert List View to Card View
            function convertToCards(section) {
                let html = `<h3>${section.querySelector("h3").textContent}</h3><div class="card-container">`;

                // Retrieve stored data (fallback to empty array if not found)
                const originalData = JSON.parse(section.dataset.originalData || "[]");

                originalData.forEach((item) => {
                    const cardImage = `/lightoftheword/static/cards/${item.fileName.replace(".html", ".jpg")}`;

                    html += `
                        <div class="card">
                            <img src="${cardImage}" alt="${item.title}" data-date="${item.date}">
                            <div class="card-content">
                                <h4>${item.title}</h4>
                                <button class="load-content" data-file="${item.fileName}" data-date="${item.date}">Summary</button>
                            </div>
                        </div>`;
                });

                html += `</div>`;
                return html;
            }

            // Function to Convert to Thumbnails View
            function convertToThumbnails(section) {
                let html = `<h3>${section.querySelector("h3").textContent}</h3><div class="thumbnail-container">`;

                // Retrieve stored data (fallback to empty array if not found)
                const originalData = JSON.parse(section.dataset.originalData || "[]");

                originalData.forEach((item) => {
                    const cardImage = `/lightoftheword/static/cards/${item.fileName.replace(".html", ".jpg")}`;

                    html += `
                        <div class="thumbnail">
                            <img src="${cardImage}" alt="${item.title}" data-date="${item.date}">
                            <div class="card-content">
                                <h4>${item.title}</h4>
                                <button class="load-content" data-file="${item.fileName}" data-date="${item.date}">Summary</button>
                            </div>
                        </div>`;
                });

                html += `</div>`;
                return html;
            }

            // Function to Convert Card View Back to Accordion (List View)
            function convertToAccordion(section) {
                let html = `<h3>${section.querySelector('h3').textContent}</h3>`;

                section.querySelectorAll('.card').forEach(card => {
                    const title = card.querySelector('h4').textContent;
                    const fileName = card.querySelector('.load-content').getAttribute('data-file');
                    const date = card.querySelector('.load-content').getAttribute('data-date');

                    html += `
                        <div class="accordion" data-file="${fileName}" data-date="${date}">
                            <span class="accordion-title">${title}</span>
                        </div>
                        <div class="accordion-content" style="display: none;">
                            <div class="content-placeholder"></div>
                        </div>`;
                });

                return html;
            }

            
            // Initialize with the default "card" view
            switchToCardView();
    

            // Get modal elements
            const summaryModal = document.getElementById('summary-modal');
            const fullModal = document.getElementById('full-content-modal');

            const summaryModalBody = document.getElementById('summary-modal-body');
            const fullModalBody = document.getElementById('full-modal-body');

            const summaryModalImage = document.getElementById('summary-modal-image');
            const fullModalImage = document.getElementById('full-modal-image');

            const closeButtons = document.querySelectorAll('.close-btn'); // Select all close buttons
            const readMoreButton = document.getElementById('read-more-btn'); // Read More button

            let storedImageSrc = "";
            let storedContent = "";
            let storedDate = "";

            // Function to format the date (DD-MM-YYYY)
            function formatDate(dateStr) {
                const date = new Date(dateStr);
                const day = String(date.getDate()).padStart(2, '0'); // Pad single digits with leading zero
                const month = String(date.getMonth() + 1).padStart(2, '0'); // Get month (0-11), so add 1
                const year = date.getFullYear();

                return `${day}-${month}-${year}`; // Format as DD-MM-YYYY
            }

            // Open Summary Modal
            function openSummaryModal(imageSrc, content, date) {
                storedImageSrc = imageSrc;
                storedContent = content;
                storedDate = formatDate(date);

                summaryModalImage.src = imageSrc;
                summaryModalBody.innerHTML = `<p>${content.substring(0, 150)}...</p>`; // Show a short preview

                summaryModal.style.display = 'block'; // Show modal
            }

            // Open Full Content Modal
            function openFullModal() {
                fullModalImage.src = storedImageSrc;
                fullModalBody.innerHTML = `<p>${storedContent}</p><p class="content-date">Date: ${storedDate}</p>`;

                fullModal.style.display = 'block'; // Show full content modal
            }

            // Attach event to 'Read More' button
            readMoreButton.addEventListener('click', openFullModal);

            // Close modals when clicking close buttons
            closeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    summaryModal.style.display = 'none';
                    fullModal.style.display = 'none';
                });
            });

            // Close modals when clicking outside content
            window.addEventListener('click', function(event) {
                if (event.target === summaryModal) summaryModal.style.display = 'none';
                if (event.target === fullModal) fullModal.style.display = 'none';
            });

            // Attach event to dynamically loaded "Read More" buttons
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('load-content')) {
                    const fileName = event.target.getAttribute('data-file');
                    const date = event.target.getAttribute('data-date');

                    const parentElement = event.target.closest('.card') || event.target.closest('.thumbnail');
                    if (!parentElement) return;

                    const imageSrc = parentElement.querySelector('img').src;
                    fetch(`/lightoftheword/static/content/${fileName}`)
                        .then(response => response.text())
                        .then(data => {
                            openSummaryModal(imageSrc, data, date); // Open summary modal
                        })
                        .catch(error => {
                            alert("Error loading content.");
                            console.error("Error fetching content:", error);
                        });
                }
            });


            // Call the function when you need to add the card interactions
            const cardContainers = document.querySelectorAll('.card-container'); // Get the card containers

            addCardInteractions(cardContainers);
            

            function addCardInteractions(cardContainers) {
                cardContainers.forEach((container) => {
                    let cards = Array.from(container.querySelectorAll(".card"));
                    let isDragging = false;
                    let startX = 0;
                    let velocity = 0;
                    let lastX = 0;
                    let animationFrame;
                    let currentIndex = 0; // Track the front card index
                    const totalCards = cards.length;

                    // Function to update card positions based on the number of cards
                    function updateCardPositions() {
                        const cardCount = cards.length;
                        const containerWidth = container.clientWidth;
                        const cardWidth = cards[0].offsetWidth; // Get card width dynamically
                        const totalShift = Math.min(containerWidth - cardWidth, 200); // Max offset limit

                        cards.forEach((card, index) => {
                            const offset = index - currentIndex; // Offset relative to active card
                            const scale = 1 - Math.abs(offset) * 0.05; // Slightly shrink back cards for depth

                            // Calculate X offset so that first card starts at left, last card at right
                            const progress = cardCount > 1 ? currentIndex / (cardCount - 1) : 0; // Avoid division by 0
                            const xOffset = offset * 20 + progress * totalShift; // Dynamic positioning

                            // Ensure selected card is on top
                            const zIndex = index === currentIndex ? cardCount + 1 : cardCount - Math.abs(offset);

                            // Apply transformations
                            card.style.transform = `translateX(${xOffset}px) scale(${scale})`;
                            card.style.opacity = index === currentIndex ? 1 : 0.7; // Highlight selected card
                            card.style.zIndex = zIndex; // Ensure selected card is on top
                        });
                    }


                    // Handle touch/swipe interaction
                    function handleTouchStart(e) {
                        isDragging = true;
                        startX = e.clientX || e.touches[0].clientX;
                        velocity = 0;
                        lastX = startX;
                        cancelAnimationFrame(animationFrame);
                    }

                    function handleTouchMove(e) {
                        if (!isDragging) return;

                        let currentX = e.clientX || e.touches[0].clientX;
                        velocity = currentX - lastX;
                        lastX = currentX;

                        // Swipe through cards dynamically based on touch movement
                        if (Math.abs(velocity) > 5) {
                            if (velocity > 0) {
                                currentIndex = (currentIndex - 1 + cards.length) % cards.length; // Move backward
                            } else {
                                currentIndex = (currentIndex + 1) % cards.length; // Move forward
                            }
                            updateCardPositions();
                        }
                    }

                    function handleTouchEnd() {
                        if (!isDragging) return;
                        isDragging = false;
                    }

                    // Handle hover to select a card (desktop)
                    function handleCardHover(e) {
                        const hoveredCard = e.target.closest('.card');
                        if (hoveredCard) {
                            // Add the 'selected' class to the hovered card
                            cards.forEach(card => card.classList.remove('selected')); // Remove 'selected' class from all cards
                            hoveredCard.classList.add('selected'); // Add 'selected' to hovered card
                            currentIndex = cards.indexOf(hoveredCard);
                            updateCardPositions();
                        }
                    }

                    // Event listeners for mobile touch interactions
                    container.addEventListener("touchstart", handleTouchStart);
                    container.addEventListener("touchmove", handleTouchMove);
                    container.addEventListener("touchend", handleTouchEnd);

                    // Event listeners for desktop hover interactions
                    container.addEventListener("mousemove", handleCardHover);

                    // Initialize card positions
                    updateCardPositions();
                });
            }
        });
    </script>
    
    
</body>
</html>
